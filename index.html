<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dia de sol — Frases escondidas + paisagens</title>
  <style>
    html, body { height: 100%; margin: 0; overflow: hidden; background:#0b1020; }
    canvas { display:block; width:100vw; height:100vh; }
    .hud{
      position:fixed; left:16px; top:16px; z-index:10;
      font:14px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:rgba(255,255,255,.92);
      background:rgba(10,12,24,.38);
      border:1px solid rgba(255,255,255,.14);
      border-radius:14px;
      padding:10px 12px;
      backdrop-filter:blur(10px);
      user-select:none;
      max-width:min(420px, calc(100vw - 32px));
    }
    .row{ display:flex; gap:10px; align-items:center; margin-top:8px; }
    .row label{ min-width:88px; opacity:.85; }
    .row input{ width:180px; }
    .hint{ opacity:.75; margin-top:8px; }
    .btns{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .btn{
      padding:8px 10px; border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.08);
      color:rgba(255,255,255,.92);
      cursor:pointer;
    }
    .btn:active{ transform:translateY(1px); }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.06);
      margin-top:8px;
      opacity:.92;
      font-size:12px;
    }
    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      padding:12px 14px; border-radius:16px;
      background:rgba(10,12,24,.60);
      border:1px solid rgba(255,255,255,.14);
      backdrop-filter:blur(10px);
      color:rgba(255,255,255,.97);
      font:15px/1.28 system-ui,-apple-system,Segoe UI,Roboto,Arial;
      max-width:min(760px, calc(100vw - 36px));
      text-align:center;
      pointer-events:none;
      opacity:0;
      transition:opacity .18s ease;
      box-shadow:0 12px 38px rgba(0,0,0,.22);
      white-space:pre-wrap;
    }
    .toast.show{ opacity:1; }
    .toast small{ display:block; opacity:.75; margin-top:6px; font-size:12px; }
  </style>
</head>
<body>
<canvas id="c"></canvas>

<div class="hud">
  <div><b>Paisagens</b> — clique nos objetos para achar frases</div>
  <div class="pill">
    <span id="sceneName">Campo (Dia)</span>
    <span>•</span>
    <span>Descobertas: <b id="found">0</b></span>
  </div>

  <div class="row">
    <label>Velocidade</label>
    <input id="speed" type="range" min="0" max="200" value="120">
    <span id="speedVal">1.20</span>
  </div>
  <div class="row">
    <label>Ondulação</label>
    <input id="bob" type="range" min="0" max="120" value="70">
    <span id="bobVal">0.70</span>
  </div>

  <div class="btns">
    <button class="btn" id="toggle">Pausar</button>
    <button class="btn" id="nextScene">Mudar paisagem</button>
    <button class="btn" id="hintBtn">Dica</button>
  </div>

  <div class="hint" id="hint">
    Dica: sol/lua, nuvens/estrelas, personagem, pipa, pássaros, árvore, flores, placa, pedras… (tecla <b>M</b> muda paisagem)
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
(() => {
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d', { alpha:false });

  const speedEl = document.getElementById('speed');
  const bobEl   = document.getElementById('bob');
  const speedVal = document.getElementById('speedVal');
  const bobVal = document.getElementById('bobVal');
  const toggleBtn = document.getElementById('toggle');
  const nextSceneBtn = document.getElementById('nextScene');
  const hintBtn = document.getElementById('hintBtn');
  const hintEl = document.getElementById('hint');
  const toast = document.getElementById('toast');
  const foundEl = document.getElementById('found');
  const sceneNameEl = document.getElementById('sceneName');

  let W=0, H=0, DPR=1;
  function resize(){
    DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    W = Math.floor(window.innerWidth * DPR);
    H = Math.floor(window.innerHeight * DPR);
    canvas.width = W; canvas.height = H;
  }
  window.addEventListener('resize', resize);
  resize();

  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const lerp=(a,b,t)=>a+(b-a)*t;

  // Toast
  let toastTimer=null;
  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }
  function showToast(text, tag=''){
    toast.innerHTML = `${escapeHtml(text)}${tag ? `<small>${escapeHtml(tag)}</small>` : ''}`;
    toast.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=>toast.classList.remove('show'), 2600);
  }

  // Controles
  let speed=1.2, bob=0.7;
  function readControls(){
    speed = Number(speedEl.value)/100;
    bob   = Number(bobEl.value)/100;
    speedVal.textContent = speed.toFixed(2);
    bobVal.textContent   = bob.toFixed(2);
  }
  speedEl.addEventListener('input', readControls);
  bobEl.addEventListener('input', readControls);
  readControls();

  // Estado
  let paused=false;
  let wind=0, windTarget=0;
  let pulse=0;

  toggleBtn.addEventListener('click', ()=>{
    paused = !paused;
    toggleBtn.textContent = paused ? 'Continuar' : 'Pausar';
  });

  hintBtn.addEventListener('click', ()=>{
    hintEl.style.display = (hintEl.style.display === 'none') ? '' : 'none';
  });

  // ===== IMPORTANTE: objetos que setScene usa precisam existir ANTES =====
  const kite = { active:true, x:0.55, y:0.22, s:1.0, t:0, hx:0,hy:0,hr:0 };
  let shellsActive = false;

  // Paisagens
  const scenes = [
    { name:"Campo (Dia)", sky:['#79c7ff','#a7e6ff','#e8fbff'], ground:['#8fe38a','#2fb86a'],
      sun:{on:true,x:0.82,y:0.18,r:0.075}, moon:{on:false}, stars:false, extras:'campo' },
    { name:"Praia (Pôr do Sol)", sky:['#ffb36a','#ff7aa8','#5b78ff'], ground:['#ffe08a','#ffbf4a'],
      sun:{on:true,x:0.72,y:0.25,r:0.070}, moon:{on:false}, stars:false, extras:'praia' },
    { name:"Montanha (Amanhecer)", sky:['#a7d7ff','#f3d9ff','#fff6d5'], ground:['#74d6a0','#1e9f73'],
      sun:{on:true,x:0.18,y:0.23,r:0.070}, moon:{on:false}, stars:false, extras:'montanha' },
    { name:"Cidade (Noite)", sky:['#0a0f2a','#132a52','#1b3b6f'], ground:['#2c395a','#141c33'],
      sun:{on:false}, moon:{on:true,x:0.80,y:0.20,r:0.060}, stars:true, extras:'cidade' }
  ];
  let sceneIndex = 0;

  function setScene(i){
    sceneIndex = (i + scenes.length) % scenes.length;
    sceneNameEl.textContent = scenes[sceneIndex].name;
    kite.active = (scenes[sceneIndex].extras !== 'cidade');
    shellsActive = (scenes[sceneIndex].extras === 'praia');
  }

  nextSceneBtn.addEventListener('click', ()=> setScene(sceneIndex+1));
  window.addEventListener('keydown', (e)=>{ if (e.key.toLowerCase()==='m') setScene(sceneIndex+1); });
  setScene(0);

  // Frases
  const secrets = {
    sun: [
      "'Vitória' é quando você não desiste de você.",
      "Brilha: o mundo ainda não viu seu melhor ângulo.",
      "Você já venceu tudo que achou que não ia aguentar.",
      "O sol nasce de novo. Você também.",
      "Se hoje foi difícil, amanhã é treino com bônus.",
      "Vencer não é “dar certo”; é “seguir”.",
      "Quem insiste, ilumina.",
      "Seu foco é seu raio-laser (mas sem queimar a si).",
      "Pequena vitória de hoje = grande história amanhã.",
      "A cada queda, você aprende a pousar melhor."
    ],
    moon: [
      "Vitória silenciosa: continuar quando ninguém aplaude.",
      "No escuro, seu passo vira farol.",
      "Descanso também é estratégia de campeão.",
      "A noite é só o intervalo do seu próximo acerto.",
      "Você não está atrasado; está em construção."
    ],
    cloud: [
      "Tira a nuvem da cabeça: você dá conta.",
      "Às vezes a vitória é só respirar sem culpa.",
      "Deu ruim? Recarrega e vai de novo: modo nuvem.",
      "Nuvem passa. Você fica.",
      "Seu tempo não é tempo perdido.",
      "Você não precisa estar 100% pra avançar 1%.",
      "Leve é quem aprende a soltar.",
      "Chuva não estraga: prepara."
    ],
    star: [
      "Vitória de verdade: achar luz onde parecia vazio.",
      "Cada estrela é um “eu consegui” bem longe.",
      "Você é constância com brilho discreto.",
      "Seja firme: o céu respeita quem insiste.",
      "O impossível é só o “ainda não” com roupa bonita."
    ],
    character: [
      "Passo a passo: é assim que a vitória anda.",
      "Você não está lento; está sólido.",
      "Seu progresso não pede permissão: ele acontece.",
      "A vitória gosta de rotina.",
      "Hoje você ganhou de ontem: placar 1x0.",
      "Você é o tipo de pessoa que termina o que começa (mesmo aos poucos).",
      "Quem tem calma não “perde tempo”, ganha tempo.",
      "Repetição vira habilidade. Habilidade vira vitória.",
      "Você é persistente; o resto é detalhe.",
      "Meta: ser gentil e constante — campeão em duas categorias."
    ],
    stone: [
      "Vitória: não tropeçar no mesmo medo duas vezes.",
      "Pedra no caminho? Ótimo: dá pra subir nela.",
      "Avida pedregosa… te deixa mais “lapidado”.",
      "Toda pedrinha é um lembrete: você chegou até aqui.",
      "Se a pedra é grande, divide em pedacinhos (e vai)."
    ],
    tree: [
      "Vitória é criar raiz sem perder o sonho.",
      "Crescer é lento. E é assim mesmo.",
      "Você não precisa provar nada: só florescer.",
      "Quem planta constância colhe resultado.",
      "Vai dar “fruto”, confia."
    ],
    flower: [
      "Vitória delicada: ser suave e ainda assim forte.",
      "Florescer não é pressa; é estação.",
      "Você merece dias bons sem negociar sua paz.",
      "Seu bem-estar é “pétala” fundamental.",
      "Bonito também é resistir com cor."
    ],
    kite: [
      "Pipa no alto: vitória é ter linha e ter céu.",
      "Hoje o plano é ‘voar’… sem ‘pifar’.",
      "Quem segura a linha também está ganhando.",
      "Vento forte? Ajusta o ângulo e sobe.",
      "Vitória é brincar com o risco sem perder o controle."
    ],
    bird: [
      "Vitória é achar rota quando muda o vento.",
      "Siga firme e “passe” por cima.",
      "Quem voa junto vai mais longe (sem competir).",
      "Você não precisa bater asas o tempo todo: plane também.",
      "Seu caminho não precisa ser igual ao dos outros."
    ],
    sign: [
      "Placa do dia: siga. Mesmo sem mapa perfeito.",
      "Vitória é dizer ‘sim’ pra você.",
      "Seu futuro não ‘aponta’, ele responde.",
      "Se der dúvida, vira à direita: rumo ao possível.",
      "Você está mais perto do que parece."
    ],
    shell: [
      "Vitória: ouvir o próprio silêncio sem medo.",
      "‘mar’ de tarefas? Vai de onda em onda.",
      "Você não precisa carregar tudo: larga um pouco na areia.",
      "Coisa pequena, brilho grande.",
      "O que é seu volta — com calma."
    ]
  };

  const used = new Set();
  let foundCount = 0;
  function pickSecret(key){
    const list = secrets[key] || ["Você achou um segredo."];
    for (let i=0;i<14;i++){
      const msg = list[(Math.random()*list.length)|0];
      const k = sceneIndex + "::" + key + "::" + msg;
      if (!used.has(k)){
        used.add(k);
        foundCount++;
        foundEl.textContent = String(foundCount);
        return msg;
      }
    }
    return list[(Math.random()*list.length)|0];
  }

  // Objetos / hitboxes
  const clickables = [];
  const addClickable = (id, name, type, getBounds) => clickables.push({id,name,type,getBounds});

  // Sol/Lua
  const orb = { x:0, y:0, r:0, type:'sun' };
  addClickable('orb','Sol/Lua','sun',()=>({x:orb.x,y:orb.y,r:orb.r}));

  // Estrelas clicáveis (noite)
  const constellations = Array.from({length:6}, (_,i)=>({
    id:'star_'+i, x:Math.random()*0.9+0.05, y:Math.random()*0.35+0.06, r:(10+Math.random()*16)
  }));
  for (const st of constellations){
    addClickable(st.id,'Estrela','star',()=>({x:st.x*W,y:st.y*H,r:st.r*DPR}));
  }

  // Nuvens
  const clouds = Array.from({ length: 6 }, (_, i) => ({
    id:"cloud_"+i, x:Math.random(), y:lerp(0.10,0.45,Math.random()),
    s:lerp(0.55,1.10,Math.random())*(i%2?1:0.9),
    v:lerp(0.010,0.030,Math.random()),
    hx:0, hy:0, hr:0
  }));
  for (const c of clouds) addClickable(c.id,'Nuvem','cloud',()=>({x:c.hx,y:c.hy,r:c.hr}));

  // Pedras
  const stones = Array.from({ length: 10 }, (_, i) => ({
    id:"stone_"+i, x:lerp(0.08,0.92,Math.random()),
    y:lerp(0.80,0.93,Math.random()), s:lerp(0.7,1.3,Math.random()),
    rot:Math.random()*Math.PI*2
  }));
  for (const st of stones) addClickable(st.id,'Pedrinha','stone',()=>({x:st.x*W,y:st.y*H,r:(12*st.s)*DPR}));

  // Árvore + flores
  const tree = { x:0.16, y:0.64, s:1.0 };
  addClickable('tree','Árvore','tree',()=>({x:tree.x*W,y:tree.y*H,r:(70*tree.s)*DPR}));

  const flowers = Array.from({length:8}, (_,i)=>({
    id:'flower_'+i, x:lerp(0.10,0.90,Math.random()),
    y:lerp(0.80,0.92,Math.random()), s:lerp(0.7,1.25,Math.random()),
    phase:Math.random()*Math.PI*2
  }));
  for (const fl of flowers) addClickable(fl.id,'Flor','flower',()=>({x:fl.x*W,y:fl.y*H,r:(14*fl.s)*DPR}));

  // Placa
  const sign = { x:0.84, y:0.76, s:1.0 };
  addClickable('sign','Placa','sign',()=>({x:sign.x*W,y:sign.y*H,r:(46*sign.s)*DPR}));

  // Pássaros
  const birds = Array.from({length:5}, (_,i)=>({
    id:'bird_'+i, x:Math.random()*0.9+0.05, y:lerp(0.10,0.32,Math.random()),
    s:lerp(0.8,1.3,Math.random()), v:lerp(0.06,0.10,Math.random())*(i%2?1:-1),
    hx:0, hy:0, hr:0
  }));
  for (const b of birds) addClickable(b.id,'Pássaro','bird',()=>({x:b.hx,y:b.hy,r:b.hr}));

  // Pipa
  addClickable('kite','Pipa','kite',()=>({x:kite.hx,y:kite.hy,r:kite.hr}));

  // Conchas (praia)
  const shells = Array.from({length:6}, (_,i)=>({
    id:'shell_'+i, x:lerp(0.12,0.90,Math.random()),
    y:lerp(0.83,0.94,Math.random()), s:lerp(0.8,1.25,Math.random()),
    rot:Math.random()*Math.PI*2
  }));
  for (const sh of shells){
    addClickable(sh.id,'Concha','shell',()=>({x:sh.x*W,y:sh.y*H,r:(14*sh.s)*DPR}));
  }

  // Personagem
  const char = { x:0.15, dir:1, walk:0, hx:0,hy:0,hr:0 };
  addClickable('character','Personagem','character',()=>({x:char.hx,y:char.hy,r:char.hr}));

  // Clique
  window.addEventListener('pointerdown', (e)=>{
    const rect = canvas.getBoundingClientRect();
    const px = (e.clientX - rect.left) * DPR;
    const py = (e.clientY - rect.top) * DPR;

    pulse = 1.25;

    let hit=null, best=Infinity;
    for (const obj of clickables){
      const b = obj.getBounds();
      if (!b || !isFinite(b.r) || b.r<=0) continue;

      if (obj.type === 'shell' && !shellsActive) continue;
      if (obj.id === 'orb'){
        const sc = scenes[sceneIndex];
        if (orb.type==='sun'  && !sc.sun.on)  continue;
        if (orb.type==='moon' && !sc.moon.on) continue;
      }
      if (obj.id === 'kite' && !kite.active) continue;

      const dx=px-b.x, dy=py-b.y;
      const d=Math.hypot(dx,dy);
      if (d<=b.r && d<best){ best=d; hit=obj; }
    }

    if (hit){
      const key = (hit.id==='orb') ? orb.type : hit.type;
      showToast(pickSecret(key), `Encontrado: ${hit.name}`);
    }
  });

  // vento
  window.addEventListener('pointermove', (e)=>{
    const x = (e.clientX / window.innerWidth) * 2 - 1;
    windTarget = clamp(x, -1, 1);
  });

  // Desenho helpers
  const sparkles = Array.from({length:80}, ()=>({a:Math.random()*Math.PI*2,r:Math.random()}));
  function roundRect(x,y,w,h,r){
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    ctx.closePath();
  }

  function drawBackground(t){
    const sc = scenes[sceneIndex];

    // céu
    const sky = ctx.createLinearGradient(0,0,0,H);
    sky.addColorStop(0, sc.sky[0]);
    sky.addColorStop(0.45, sc.sky[1]);
    sky.addColorStop(1, sc.sky[2]);
    ctx.fillStyle = sky;
    ctx.fillRect(0,0,W,H);

    // estrelas
    if (sc.stars){
      ctx.save();
      ctx.globalAlpha = 0.85;
      ctx.fillStyle = 'rgba(255,255,255,0.9)';
      for (let i=0;i<140;i++){
        const x = (Math.sin(i*999.1)*0.5+0.5)*W;
        const y = (Math.sin(i*333.7 + 1.2)*0.5+0.5)*H*0.55;
        const r = ((i%5)+1)*0.35*DPR;
        ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
      }
      ctx.globalAlpha = 0.95;
      for (const st of constellations){
        const x=st.x*W, y=st.y*H;
        ctx.beginPath(); ctx.arc(x,y,2.2*DPR,0,Math.PI*2); ctx.fill();
        ctx.globalAlpha = 0.25;
        ctx.beginPath(); ctx.arc(x,y,(st.r*0.75)*DPR,0,Math.PI*2); ctx.fill();
        ctx.globalAlpha = 0.95;
      }
      ctx.restore();
    }

    // sol/lua
    const minSide = Math.min(W,H);
    if (sc.sun.on){
      const sx=W*sc.sun.x, sy=H*sc.sun.y;
      const R=minSide*sc.sun.r*(1 + pulse*0.10*(0.5+0.5*Math.sin(t*8)));
      orb.x=sx; orb.y=sy; orb.r=R*1.15; orb.type='sun';

      const halo=ctx.createRadialGradient(sx,sy,R*0.2,sx,sy,R*2.4);
      halo.addColorStop(0,'rgba(255,245,180,0.95)');
      halo.addColorStop(0.35,'rgba(255,240,160,0.35)');
      halo.addColorStop(1,'rgba(255,240,160,0)');
      ctx.fillStyle=halo;
      ctx.beginPath(); ctx.arc(sx,sy,R*2.4,0,Math.PI*2); ctx.fill();

      const sun=ctx.createRadialGradient(sx,sy,R*0.1,sx,sy,R);
      sun.addColorStop(0,'#fff7c9');
      sun.addColorStop(1,'#ffd36a');
      ctx.fillStyle=sun;
      ctx.beginPath(); ctx.arc(sx,sy,R,0,Math.PI*2); ctx.fill();

      ctx.save();
      ctx.translate(sx,sy);
      ctx.globalAlpha = 0.22 + 0.10*Math.sin(t*2);
      ctx.strokeStyle = '#fff1a8';
      ctx.lineWidth = Math.max(1, R*0.10);
      for (let i=0;i<14;i++){
        const a=(i/14)*Math.PI*2 + t*0.08;
        ctx.beginPath();
        ctx.moveTo(Math.cos(a)*R*1.15, Math.sin(a)*R*1.15);
        ctx.lineTo(Math.cos(a)*R*1.85, Math.sin(a)*R*1.85);
        ctx.stroke();
      }
      ctx.restore();

      if (pulse>0.001){
        ctx.save();
        ctx.translate(sx,sy);
        ctx.globalAlpha = clamp(pulse,0,1)*0.55;
        ctx.fillStyle = '#fffbe2';
        for (const s of sparkles){
          const a=s.a+t*0.6, rr=R*(1.2+s.r*1.9);
          ctx.beginPath();
          ctx.arc(Math.cos(a)*rr, Math.sin(a)*rr, (1.2+2.2*s.r)*DPR, 0, Math.PI*2);
          ctx.fill();
        }
        ctx.restore();
      }
    } else if (sc.moon.on){
      const mx=W*sc.moon.x, my=H*sc.moon.y;
      const R=minSide*sc.moon.r*(1 + pulse*0.08*(0.5+0.5*Math.sin(t*7)));
      orb.x=mx; orb.y=my; orb.r=R*1.25; orb.type='moon';

      const halo=ctx.createRadialGradient(mx,my,R*0.2,mx,my,R*2.8);
      halo.addColorStop(0,'rgba(220,235,255,0.55)');
      halo.addColorStop(1,'rgba(220,235,255,0)');
      ctx.fillStyle=halo;
      ctx.beginPath(); ctx.arc(mx,my,R*2.8,0,Math.PI*2); ctx.fill();

      ctx.fillStyle = 'rgba(240,245,255,0.92)';
      ctx.beginPath(); ctx.arc(mx,my,R,0,Math.PI*2); ctx.fill();

      ctx.globalCompositeOperation='destination-out';
      ctx.fillStyle='rgba(0,0,0,1)';
      ctx.beginPath(); ctx.arc(mx+R*0.35,my-R*0.10,R*0.9,0,Math.PI*2); ctx.fill();
      ctx.globalCompositeOperation='source-over';
    } else {
      orb.x=-1; orb.y=-1; orb.r=0; orb.type='sun';
    }

    // chão
    const groundY = H*0.78;
    const g = ctx.createLinearGradient(0,groundY,0,H);
    g.addColorStop(0, sc.ground[0]);
    g.addColorStop(1, sc.ground[1]);
    ctx.fillStyle=g;
    ctx.fillRect(0,groundY,W,H-groundY);
  }

  function drawCloud(c,t){
    const px=c.x*W, py=c.y*H;
    const size=c.s*Math.min(W,H)*0.12;
    const drift=(wind*0.20 + Math.sin(t*0.6 + c.x*10)*0.05)*size;
    const ox=px+drift;
    const oy=py+Math.sin(t*0.7 + c.x*6)*size*0.05;

    c.hx=ox; c.hy=oy; c.hr=size*1.15;

    ctx.save();
    ctx.translate(ox,oy);
    ctx.globalAlpha=0.85;
    ctx.fillStyle='rgba(255,255,255,0.92)';
    const blobs=[[-0.9,0.10,0.65],[-0.2,-0.05,0.85],[0.5,0.12,0.70],[0.1,0.25,0.75]];
    ctx.beginPath();
    for (const [bx,by,br] of blobs){
      ctx.moveTo((bx+br)*size, by*size);
      ctx.arc(bx*size, by*size, br*size, 0, Math.PI*2);
    }
    ctx.fill();
    ctx.globalAlpha=0.12;
    ctx.fillStyle='rgba(0,0,0,1)';
    ctx.beginPath();
    ctx.ellipse(0, size*0.42, size*1.55, size*0.38, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.restore();
  }

  function drawStones(t){
    for (const st of stones){
      const x=st.x*W, y=st.y*H;
      const r=(7+6*st.s)*DPR;
      ctx.save();
      ctx.translate(x,y);
      ctx.rotate(st.rot + t*0.08);
      ctx.globalAlpha=0.22;
      ctx.fillStyle='rgba(10,12,24,1)';
      ctx.beginPath(); ctx.ellipse(0,0,r*1.15,r*0.75,0,0,Math.PI*2); ctx.fill();
      ctx.restore();
    }
  }

  function drawShells(t){
    if (!shellsActive) return;
    for (const sh of shells){
      const x=sh.x*W, y=sh.y*H;
      const r=(6+6*sh.s)*DPR;
      ctx.save();
      ctx.translate(x,y);
      ctx.rotate(sh.rot);
      ctx.globalAlpha=0.35;
      ctx.fillStyle='rgba(255,255,255,0.85)';
      ctx.beginPath();
      ctx.arc(0,0,r,Math.PI,Math.PI*2);
      ctx.closePath();
      ctx.fill();
      ctx.restore();
    }
  }

  function drawTree(t){
    if (scenes[sceneIndex].extras === 'cidade') return;
    const x=tree.x*W, y=tree.y*H;
    const sway=Math.sin(t*0.8 + wind*0.8)*3*DPR;

    ctx.save();
    ctx.globalAlpha=0.85;
    ctx.fillStyle='rgba(90,60,35,0.95)';
    roundRect(x-10*DPR, y-50*DPR, 20*DPR, 60*DPR, 8*DPR);
    ctx.fill();

    ctx.translate(x, y-55*DPR);
    ctx.rotate(sway*0.002);
    ctx.fillStyle='rgba(35,140,90,0.95)';
    ctx.beginPath(); ctx.arc(0,0,40*DPR,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(-28*DPR,10*DPR,30*DPR,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(30*DPR,12*DPR,28*DPR,0,Math.PI*2); ctx.fill();
    ctx.restore();
  }

  function drawFlowers(t){
    if (scenes[sceneIndex].extras === 'cidade') return;
    for (const fl of flowers){
      const x=fl.x*W, y=fl.y*H;
      const sway=Math.sin(t*1.2 + fl.phase)*2.2*DPR;

      ctx.save();
      ctx.globalAlpha=0.9;
      ctx.strokeStyle='rgba(30,120,80,0.9)';
      ctx.lineWidth=2.2*DPR;
      ctx.beginPath();
      ctx.moveTo(x,y);
      ctx.lineTo(x+sway, y-10*fl.s*DPR);
      ctx.stroke();

      const fx=x+sway, fy=y-10*fl.s*DPR;
      ctx.fillStyle='rgba(255,79,163,0.92)';
      for (let i=0;i<5;i++){
        const a=i*(Math.PI*2/5) + t*0.2;
        ctx.beginPath();
        ctx.ellipse(fx+Math.cos(a)*4*DPR, fy+Math.sin(a)*4*DPR, 4.5*fl.s*DPR, 2.8*fl.s*DPR, a, 0, Math.PI*2);
        ctx.fill();
      }
      ctx.fillStyle='rgba(54,182,255,0.92)';
      ctx.beginPath(); ctx.arc(fx,fy,2.6*fl.s*DPR,0,Math.PI*2); ctx.fill();
      ctx.restore();
    }
  }

  function drawSign(t){
    const sc = scenes[sceneIndex];
    if (sc.extras === 'praia') return;
    const x=sign.x*W, y=sign.y*H;
    ctx.save();
    ctx.globalAlpha=0.9;
    ctx.fillStyle='rgba(90,60,35,0.95)';
    roundRect(x-4*DPR, y-38*DPR, 8*DPR, 44*DPR, 4*DPR);
    ctx.fill();
    ctx.fillStyle='rgba(245,245,255,0.88)';
    roundRect(x-34*DPR, y-68*DPR, 68*DPR, 26*DPR, 8*DPR);
    ctx.fill();
    ctx.restore();
  }

  function drawBirds(t){
    if (scenes[sceneIndex].extras === 'cidade') return;
    for (const b of birds){
      if (!paused){
        b.x += b.v * dt * 0.22;
        b.y += Math.sin(t*1.3 + b.x*8)*dt*0.02;
      }
      if (b.x>1.18) b.x=-0.18;
      if (b.x<-0.18) b.x=1.18;

      const x=b.x*W, y=b.y*H;
      const s=8*b.s*DPR;
      b.hx=x; b.hy=y; b.hr=18*DPR;

      ctx.save();
      ctx.globalAlpha=0.75;
      ctx.strokeStyle='rgba(10,12,24,0.85)';
      ctx.lineWidth=2.2*DPR;
      const flap = Math.sin(t*8 + b.id.length)*0.6;
      ctx.beginPath();
      ctx.moveTo(x,y);
      ctx.quadraticCurveTo(x-s, y - s*0.8*flap, x-2*s, y);
      ctx.moveTo(x,y);
      ctx.quadraticCurveTo(x+s, y - s*0.8*flap, x+2*s, y);
      ctx.stroke();
      ctx.restore();
    }
  }

  function drawKite(t){
    if (!kite.active){ kite.hx=-1; kite.hy=-1; kite.hr=0; return; }
    const x = (0.56 + wind*0.04 + Math.sin(t*0.7)*0.03) * W;
    const y = (0.22 + Math.cos(t*0.9)*0.02) * H;
    kite.hx=x; kite.hy=y; kite.hr=28*DPR;

    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(Math.sin(t*0.8)*0.25);
    ctx.globalAlpha=0.92;
    ctx.fillStyle='rgba(255,79,163,0.92)';
    ctx.beginPath();
    ctx.moveTo(0,-16*DPR); ctx.lineTo(14*DPR,0); ctx.lineTo(0,16*DPR); ctx.lineTo(-14*DPR,0);
    ctx.closePath(); ctx.fill();
    ctx.fillStyle='rgba(54,182,255,0.92)';
    ctx.beginPath();
    ctx.moveTo(0,-12*DPR); ctx.lineTo(10*DPR,0); ctx.lineTo(0,12*DPR); ctx.lineTo(-10*DPR,0);
    ctx.closePath(); ctx.fill();
    ctx.restore();
  }

  function drawCharacter(t){
    const groundY = H*0.78;

    const v=0.03*speed;
    char.x += (char.dir*v)*dt;
    if (char.x>0.86){ char.x=0.86; char.dir=-1; }
    if (char.x<0.14){ char.x=0.14; char.dir= 1; }
    char.walk += dt*6.0*speed;

    const px=char.x*W;
    const scale=Math.min(W,H)*0.00135;
    const s=150*scale;

    const step=Math.sin(char.walk);
    const bobY=step*(10*s/150)*bob;
    const y=groundY-(120*scale*150)+bobY;

    char.hx=px; char.hy=y-18*s/150; char.hr=52*s/150;

    ctx.save();
    ctx.globalAlpha=0.22;
    ctx.fillStyle='rgba(0,0,0,1)';
    ctx.beginPath();
    ctx.ellipse(px, groundY-10*DPR, (58+10*Math.abs(step))*scale*150, (14+4*Math.abs(step))*scale*150, 0,0,Math.PI*2);
    ctx.fill();
    ctx.restore();

    ctx.save();
    ctx.translate(px,y);
    ctx.scale(char.dir,1);

    const pink='#ff4fa3';
    const blue='#36b6ff';
    const navy='rgba(10,12,24,0.9)';

    const leg1=Math.sin(char.walk)*0.55;
    const leg2=Math.sin(char.walk+Math.PI)*0.55;

    const limb=(x1,y1,len,thick,ang,color)=>{
      ctx.save();
      ctx.translate(x1,y1);
      ctx.rotate(ang);
      ctx.strokeStyle=color;
      ctx.lineCap='round';
      ctx.lineWidth=thick;
      ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(0,len); ctx.stroke();
      ctx.restore();
    };

    const torsoGrad=ctx.createLinearGradient(-26*s/150,-10*s/150, 26*s/150,60*s/150);
    torsoGrad.addColorStop(0,pink);
    torsoGrad.addColorStop(1,blue);

    ctx.fillStyle='#ffd9c7';
    ctx.beginPath(); ctx.arc(0,-48*s/150, 20*s/150, 0, Math.PI*2); ctx.fill();

    ctx.fillStyle='rgba(35,60,90,0.95)';
    ctx.beginPath(); ctx.arc(-3*s/150,-53*s/150, 20*s/150, Math.PI*1.05, Math.PI*2.1); ctx.fill();

    ctx.fillStyle=navy;
    ctx.beginPath(); ctx.arc(-6*s/150,-50*s/150, 2.2*s/150, 0, Math.PI*2); ctx.arc(6*s/150,-50*s/150, 2.2*s/150, 0, Math.PI*2); ctx.fill();

    limb(-18*s/150,-8*s/150, 36*s/150, 8*s/150, Math.sin(char.walk+Math.PI)*0.45, '#ffd9c7');
    limb( 18*s/150,-8*s/150, 36*s/150, 8*s/150, Math.sin(char.walk)*0.45, '#ffd9c7');

    ctx.fillStyle=torsoGrad;
    roundRect(-26*s/150,-18*s/150, 52*s/150,58*s/150, 14*s/150); ctx.fill();

    ctx.globalAlpha=0.35;
    ctx.fillStyle='#ffffff';
    roundRect(-20*s/150,2*s/150, 40*s/150,12*s/150, 6*s/150); ctx.fill();
    ctx.globalAlpha=1;

    ctx.fillStyle='rgba(30,145,220,0.95)';
    roundRect(-24*s/150,36*s/150, 48*s/150,26*s/150, 10*s/150); ctx.fill();

    limb(-10*s/150,58*s/150, 34*s/150, 9*s/150, leg1, 'rgba(30,145,220,0.95)');
    limb( 10*s/150,58*s/150, 34*s/150, 9*s/150, leg2, 'rgba(30,145,220,0.95)');

    ctx.strokeStyle=pink;
    ctx.lineWidth=10*s/150;
    ctx.lineCap='round';
    ctx.beginPath();
    ctx.moveTo(-10*s/150 + Math.sin(leg1)*6*s/150, 92*s/150); ctx.lineTo(-2*s/150, 92*s/150);
    ctx.moveTo( 10*s/150 + Math.sin(leg2)*6*s/150, 92*s/150); ctx.lineTo( 18*s/150, 92*s/150);
    ctx.stroke();

    ctx.restore();
  }

  // Loop
  let last=performance.now();
  let dt=0;

  function frame(now){
    const t=now/1000;
    dt=(now-last)/1000;
    last=now;

    if (!paused){
      wind = lerp(wind, windTarget, 0.06);
      pulse = lerp(pulse, 0, 0.06);

      for (const c of clouds){
        c.x += (c.v + wind*0.003)*dt;
        if (c.x>1.25) c.x=-0.25;
        if (c.x<-0.25) c.x=1.25;
      }
    }

    drawBackground(t);

    // AGORA desenha as nuvens (estava faltando em alguns ajustes)
    for (const c of clouds) drawCloud(c,t);

    drawStones(t);
    drawShells(t);
    drawTree(t);
    drawFlowers(t);
    drawSign(t);
    drawBirds(t);
    drawKite(t);

    if (paused){
      const old=dt; dt=0;
      drawCharacter(t);
      dt=old;
    } else {
      drawCharacter(t);
    }

    requestAnimationFrame(frame);
  }

  requestAnimationFrame(frame);
})();
</script>
</body>
</html>
